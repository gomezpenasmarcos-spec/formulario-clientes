<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reserva tu cita</title>

<style>
  body{
    font-family: Arial, sans-serif;
    background:#f3f3f3;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    margin:0;
  }

  .container{
    background:#fff;
    padding:40px;
    border-radius:20px;
    width:420px;
    box-shadow:0 10px 30px rgba(0,0,0,.10);
  }

  h2{
    text-align:center;
    margin:0 0 28px 0;
    font-size:34px;
  }

  label{
    display:block;
    font-size:18px;
    margin:8px 0 8px;
  }

  input, select, textarea{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:1px solid #cfcfcf;
    font-size:18px;
    box-sizing:border-box;
    outline:none;
  }

  textarea{ resize:none; }

  /* === TELEFONO PROFESIONAL (bandera + prefijo alineado) === */
  .phone-group{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:18px;
  }

  /* selector bandera compacto */
  .flag-select{
    width:74px;
    height:54px;
    font-size:26px;
    border-radius:12px;
    border:1px solid #cfcfcf;
    background:#fff;
    padding:0 10px;
    cursor:pointer;
  }

  /* contenedor del prefijo + input como un solo campo */
  .phone-field{
    flex:1;
    display:flex;
    align-items:center;
    height:54px;
    border:1px solid #cfcfcf;
    border-radius:12px;
    padding:0 14px;
    background:#fff;
    box-sizing:border-box;
  }

  .prefix{
    font-size:18px;
    color:#222;
    margin-right:10px;
    white-space:nowrap;
    line-height:1;
    position:relative;
    top:0; /* por si el navegador mete baseline rara */
  }

  .phone-input{
    border:none;
    padding:0;
    margin:0;
    height:100%;
    flex:1;
    font-size:18px;
    outline:none;
  }
  .phone-input::placeholder{ color:#9b9b9b; }

  button{
    width:100%;
    padding:16px;
    border-radius:14px;
    border:none;
    background:#2f5bd7;
    color:#fff;
    font-size:22px;
    cursor:pointer;
    margin-top:10px;
  }
  button:hover{ background:#264cc0; }
</style>
</head>

<body>
  <div class="container">
    <h2>Reserva tu cita</h2>

    <form id="form">
      <input id="nombre" type="text" placeholder="Nombre completo" required />
      <input id="email" type="email" placeholder="Correo electrÃ³nico" required />

      <label>TelÃ©fono</label>
      <div class="phone-group">
        <!-- Solo banderas, el valor es el prefijo -->
        <select id="country" class="flag-select" aria-label="PaÃ­s" required>
          <option value="+34">ðŸ‡ªðŸ‡¸</option>
          <option value="+33">ðŸ‡«ðŸ‡·</option>
          <option value="+49">ðŸ‡©ðŸ‡ª</option>
          <option value="+39">ðŸ‡®ðŸ‡¹</option>
          <option value="+44">ðŸ‡¬ðŸ‡§</option>
        </select>

        <div class="phone-field">
          <span id="prefix" class="prefix">+34</span>
          <input id="telefono" class="phone-input" type="text" inputmode="numeric" placeholder="654 654 654" required />
        </div>
      </div>

      <label>Selecciona el dÃ­a</label>
      <input id="fecha" type="date" required />

      <label>Selecciona la hora</label>
      <select id="hora" required></select>

      <label>Motivo</label>
      <textarea id="mensaje" rows="3" placeholder="Escribe el motivo de la cita" required></textarea>

      <button type="submit">Reservar</button>
    </form>
  </div>

<script>
  // Bloquear dÃ­as anteriores
  const fechaInput = document.getElementById("fecha");
  const today = new Date();
  today.setHours(0,0,0,0);
  fechaInput.min = today.toISOString().split("T")[0];

  // Horas: 06:00 - 23:30 (cada 30 mins)
  const horaSelect = document.getElementById("hora");
  for (let h = 6; h < 24; h++) {
    for (const m of ["00","30"]) {
      const t = String(h).padStart(2,"0") + ":" + m;
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      horaSelect.appendChild(opt);
    }
  }

  // Prefijo segÃºn bandera
  const country = document.getElementById("country");
  const prefix = document.getElementById("prefix");
  country.addEventListener("change", () => {
    prefix.textContent = country.value;
  });

  // Formato telÃ©fono en grupos de 3 mientras escribe
  const telInput = document.getElementById("telefono");
  telInput.addEventListener("input", (e) => {
    const digits = e.target.value.replace(/\D/g, "");
    const grouped = digits.replace(/(\d{3})(?=\d)/g, "$1 ").trim();
    e.target.value = grouped;
  });

  // Submit a PRODUCCIÃ“N
  document.getElementById("form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const countryCode = country.value; // "+34"
    const telefono = telInput.value.replace(/\s/g, ""); // sin espacios

    const data = {
      nombre: document.getElementById("nombre").value.trim(),
      email: document.getElementById("email").value.trim(),
      telefono: countryCode + telefono,
      fecha_solicitada: document.getElementById("fecha").value + "T" + document.getElementById("hora").value,
      mensaje: document.getElementById("mensaje").value.trim()
    };

    await fetch("https://primary-production-4f93b.up.railway.app/webhook/cb0b99ce-d952-4988-84fd-708c61c1d9e6", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    alert("Cita enviada correctamente");
    e.target.reset();
    prefix.textContent = country.value; // vuelve a mostrar el prefijo correcto
  });
</script>
</body>
</html>
