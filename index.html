<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reserva tu cita</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f2f2f2;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.container{
    background:white;
    padding:40px;
    border-radius:15px;
    width:420px;
    box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

h2{
    text-align:center;
    margin-bottom:30px;
}

input, select, textarea{
    width:100%;
    padding:12px;
    margin-bottom:15px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
    box-sizing:border-box;
}

textarea{
    resize:none;
    height:80px;
}

.phone-group{
    display:flex;
    gap:10px;
}

.phone-group select{
    width:110px;
}

button{
    width:100%;
    padding:14px;
    background:#3a5fd1;
    color:white;
    font-size:18px;
    border:none;
    border-radius:10px;
    cursor:pointer;
}

button:hover{
    background:#2f4bb2;
}

.success{
    margin-top:15px;
    color:green;
    text-align:center;
}
</style>
</head>

<body>

<div class="container">
<h2>Reserva tu cita</h2>

<form id="formulario">

<input type="text" name="nombre" placeholder="Nombre completo" required>

<input type="email" name="email" placeholder="Correo electrÃ³nico" required>

<label>TelÃ©fono</label>
<div class="phone-group">
    <select id="countryCode">
        <option value="+34">ğŸ‡ªğŸ‡¸ +34</option>
        <option value="+33">ğŸ‡«ğŸ‡· +33</option>
        <option value="+49">ğŸ‡©ğŸ‡ª +49</option>
        <option value="+44">ğŸ‡¬ğŸ‡§ +44</option>
        <option value="+1">ğŸ‡ºğŸ‡¸ +1</option>
    </select>
    <input type="text" id="telefonoInput" placeholder="654 654 654" required>
</div>

<label>Selecciona el dÃ­a</label>
<input type="date" id="fecha" required>

<label>Selecciona la hora</label>
<select id="hora" required></select>

<label>Motivo</label>
<textarea name="mensaje" placeholder="Escribe el motivo de la cita" required></textarea>

<button type="submit">Reservar</button>

<div class="success" id="successMsg"></div>

</form>
</div>

<script>

// ğŸ”µ TU WEBHOOK DE PRODUCCIÃ“N YA CONFIGURADO
const webhookURL = "https://primary-production-4f93b.up.railway.app/webhook/cb0b99ce-d952-4988-84fd-708c61c1d9e6";

// ===== BLOQUEAR DÃAS PASADOS =====
const fechaInput = document.getElementById("fecha");
const today = new Date().toISOString().split("T")[0];
fechaInput.setAttribute("min", today);

// ===== GENERAR HORAS 06:00 â†’ 00:00 CADA 30 MIN =====
const horaSelect = document.getElementById("hora");

function generarHoras(){
    horaSelect.innerHTML = "";

    for(let h=6; h<=23; h++){
        for(let m=0; m<60; m+=30){
            let hora = String(h).padStart(2,"0") + ":" + String(m).padStart(2,"0");
            let option = document.createElement("option");
            option.value = hora;
            option.textContent = hora;
            horaSelect.appendChild(option);
        }
    }

    let midnight = document.createElement("option");
    midnight.value = "00:00";
    midnight.textContent = "00:00";
    horaSelect.appendChild(midnight);
}

generarHoras();

// ===== FORMATEO AUTOMÃTICO TELÃ‰FONO EN BLOQUES DE 3 =====
const telefonoInput = document.getElementById("telefonoInput");

telefonoInput.addEventListener("input", function(){
    let digits = this.value.replace(/\D/g,"");
    digits = digits.substring(0,9);
    this.value = digits.replace(/(\d{3})(?=\d)/g,"$1 ");
});

// ===== ENVÃO FORMULARIO =====
document.getElementById("formulario").addEventListener("submit", async function(e){
    e.preventDefault();

    const nombre = this.nombre.value;
    const email = this.email.value;
    const telefono = document.getElementById("countryCode").value + " " + telefonoInput.value.replace(/\s/g,"");
    const fecha = fechaInput.value;
    const hora = horaSelect.value;
    const mensaje = this.mensaje.value;

    const fecha_solicitada = fecha + "T" + hora;

    try{
        const response = await fetch(webhookURL,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({
                nombre,
                email,
                telefono,
                fecha_solicitada,
                mensaje
            })
        });

        if(response.ok){
            document.getElementById("successMsg").innerText = "Cita reservada correctamente";
            this.reset();
        }else{
            alert("Error al enviar el formulario");
        }

    }catch(error){
        alert("Error de conexiÃ³n");
    }
});
</script>

</body>
</html>
