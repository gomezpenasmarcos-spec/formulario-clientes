<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reserva de Cita</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/css/intlTelInput.css"/>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  background: white;
  padding: 30px;
  border-radius: 10px;
  width: 420px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

h2 {
  text-align: center;
  margin-bottom: 20px;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

button {
  background: #2563eb;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background: #1e4fd8;
}

label {
  font-size: 13px;
  margin-bottom: 5px;
  display: block;
}
</style>
</head>

<body>

<div class="container">
  <h2>Reserva tu cita</h2>

  <form id="formulario">

    <input type="text" name="nombre" placeholder="Nombre completo" required>

    <input type="email" name="email" placeholder="Correo electrónico" required>

    <label>Teléfono</label>
    <input type="tel" id="telefono" required>

    <label>Selecciona el día</label>
    <input type="date" id="fecha" required>

    <label>Selecciona la hora</label>
    <select id="hora" required></select>

    <textarea name="mensaje" placeholder="Mensaje" required></textarea>

    <button type="submit">Reservar</button>

  </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/intlTelInput.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.js"></script>

<script>

/* =========================
   1️⃣ CONFIG TELÉFONO PRO
========================= */

const inputTelefono = document.querySelector("#telefono");

const iti = window.intlTelInput(inputTelefono, {
  initialCountry: "es",
  preferredCountries: ["es", "fr", "de", "it"],
  separateDialCode: true,
  nationalMode: false
});


/* =========================
   2️⃣ BLOQUEAR DÍAS PASADOS
========================= */

const fechaInput = document.getElementById("fecha");
const hoy = new Date();
hoy.setHours(0,0,0,0);
fechaInput.min = hoy.toISOString().split("T")[0];


/* =========================
   3️⃣ GENERAR HORAS VÁLIDAS
   06:00 → 23:30
   Saltos de 30 minutos
========================= */

const horaSelect = document.getElementById("hora");

function generarHoras() {
  horaSelect.innerHTML = "";

  for (let h = 6; h <= 23; h++) {
    for (let m of [0, 30]) {

      if (h === 23 && m === 30) {
        // Permitimos 23:30
      }

      const hora = String(h).padStart(2, "0");
      const minuto = String(m).padStart(2, "0");

      const option = document.createElement("option");
      option.value = `${hora}:${minuto}`;
      option.textContent = `${hora}:${minuto}`;

      horaSelect.appendChild(option);
    }
  }
}

generarHoras();


/* =========================
   4️⃣ ENVÍO AL WEBHOOK
========================= */

document.getElementById("formulario").addEventListener("submit", async function(e) {
  e.preventDefault();

  const fecha = fechaInput.value;
  const hora = horaSelect.value;

  if (!fecha || !hora) {
    alert("Selecciona fecha y hora");
    return;
  }

  const fecha_solicitada = `${fecha}T${hora}`;

  const telefonoCompleto = iti.getNumber();

  const datos = {
    nombre: this.nombre.value,
    email: this.email.value,
    telefono: telefonoCompleto,
    mensaje: this.mensaje.value,
    fecha_solicitada: fecha_solicitada
  };

  await fetch("https://primary-production-4f93b.up.railway.app/webhook/cb0b99ce-d952-4988-84fd-708c61c1d9e6", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(datos)
  });

  alert("Reserva enviada correctamente");
  this.reset();
});

</script>

</body>
</html>
